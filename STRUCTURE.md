# Структура проекта Headcorn Mockup

## Обзор

Проект был рефакторирован для лучшей организации кода. Основной файл `main.py` (2117 строк) был разделен на логические модули.

## Новая структура

```
mockup_generator/
├── main.py                    # Главный файл приложения (упрощенный)
├── main_old.py               # Старая версия main.py (резервная копия)
├── ui/                       # UI модули
│   ├── __init__.py
│   ├── single_generation.py  # Интерфейс одиночной генерации
│   ├── batch_processing.py   # Интерфейс пакетной обработки
│   ├── image_upload.py       # Загрузка изображений
│   ├── display_results.py    # Отображение результатов
│   └── gallery_stats.py      # Статистика и галерея
├── services/                 # Сервисы
│   ├── __init__.py
│   └── upload_services.py    # Загрузка на серверы
├── config.py                 # Конфигурация
├── mockup_generator.py       # Основной генератор
├── batch_processor.py        # Пакетная обработка
├── gemini_client.py          # Клиент Gemini API
├── image_processor.py        # Обработка изображений
├── ftp_uploader.py           # FTP загрузчик
├── server_storage.py         # Хранилище на сервере
├── cache_manager.py          # Управление кэшем
└── requirements.txt          # Зависимости
```

## Модули

### UI модули (`ui/`)

#### `single_generation.py`
- Интерфейс одиночной генерации мокапов
- Настройки генерации (стиль, цвет, ракурс, логотип)
- Дополнительные опции (бирка, человек, шильдик, паттерн)
- Кнопка генерации и обработка результатов

#### `batch_processing.py`
- Интерфейс пакетной обработки коллекций
- Загрузка множественных изображений товаров
- Настройки коллекции и логотипа
- Отображение результатов пакетной обработки

#### `image_upload.py`
- Загрузка изображений товаров
- Загрузка логотипов
- Загрузка паттернов (опционально)
- Конвертация RGBA в RGB для совместимости с JPEG

#### `display_results.py`
- Отображение результатов генерации
- Динамическое обновление мокапов
- Кнопки скачивания и перегенерации
- Обработка ошибок и fallback мокапов

#### `gallery_stats.py`
- Статистика галереи
- Информация о хранилищах
- Отладочная информация

### Сервисы (`services/`)

#### `upload_services.py`
- Загрузка на FTP сервер
- Загрузка на локальный сервер
- Получение списков мокапов
- Google Drive (отключен)

## Преимущества новой структуры

1. **Читаемость**: Код разделен на логические модули
2. **Поддержка**: Легче найти и исправить ошибки
3. **Расширяемость**: Простое добавление новых функций
4. **Тестирование**: Возможность тестирования отдельных модулей
5. **Переиспользование**: Модули можно использовать в других проектах

## Запуск

```bash
# Активация виртуального окружения
source venv/bin/activate

# Установка зависимостей
pip install -r requirements.txt

# Запуск приложения
streamlit run main.py
```

## Миграция

Старый `main.py` сохранен как `main_old.py` для справки. Все функции перенесены в соответствующие модули:

- `single_generation_interface()` → `ui/single_generation.py`
- `batch_processing_interface()` → `ui/batch_processing.py`
- `display_results()` → `ui/display_results.py`
- `upload_to_*()` → `services/upload_services.py`

## Совместимость

Новая структура полностью совместима с существующими:
- Конфигурационными файлами
- Зависимостями
- API ключами
- Настройками Streamlit

## Размер файлов

- `main.py`: ~100 строк (было 2117)
- `ui/single_generation.py`: ~220 строк
- `ui/batch_processing.py`: ~200 строк
- `ui/display_results.py`: ~400 строк
- `ui/image_upload.py`: ~150 строк
- `ui/gallery_stats.py`: ~100 строк
- `services/upload_services.py`: ~80 строк

Общий размер кода остался тем же, но теперь он лучше организован.

